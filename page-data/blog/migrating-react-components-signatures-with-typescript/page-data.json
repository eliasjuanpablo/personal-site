{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/migrating-react-components-signatures-with-typescript/","result":{"data":{"markdownRemark":{"html":"<h2>Reuse code, not pain</h2>\n<p>I don't think there's something as painful as <em>really</em> <em>bad</em> components. Ok, maybe there is, but you've probably felt far from great when using components that are <strong>meant to be everywhere</strong> (e.g. your company's \"design system\") and knowing they are <strong>hacky</strong> or <strong>unflexible</strong>. You are basically doomed to replicate client code that sucks.</p>\n<p>This has recently happened to me while working for a product company. My teammates and I would import these cumbersome pieces of code that someone wrote years ago, pass mysterious props that noone knew why they were required, and beg the designers not to get too creative as <strong>we couldn't change much</strong> of what was available without <strong>making breaking changes</strong>.</p>\n<p>At some point, you may be able to cope with it (or maybe your are not so picky / opinionated), but eventually you'll find that technical debt will bite you and, as time goes by, become harder to fix.</p>\n<h2>Turning mystery into types</h2>\n<p>We were living in this world of \"ok-we-will-fix-it-eventually\", until a new engineer that was keen on Typescript joined the team.</p>\n<p>To be honest, I've never felt the need of typing Javascript (I don't necessarily add TS to every project if I don't feel like it's worth it) but I was completely blown away when he showed us the advantages that it introduced to our situation.</p>\n<p>I'll share the approach we took and how you could benefit from it.</p>\n<h3>1. Add Typescript</h3>\n<p>Luckily, we already had Typescript in our project (although we weren't using it everywhere, so our common components weren't typed anyway). This first step <strong>might be a dealbreaker</strong> for your team if for some reason you are not willing to add it. However, setting it up isn't a big deal and it can be adopted partially <strong>along preexisting JS</strong> (after all, TS is nothing more than a superset of the latter).</p>\n<h3>2. Identify existing signatures</h3>\n<p>Maybe you already have <strong>PropTypes</strong> for your components (they don't enforce much, but they help identifying what's going on right now). If not, you will have to spend some time <strong>finding all occurrences</strong> of a component so you don't overlook any uses cases.</p>\n<h3>3. Declare an interface</h3>\n<p>Create an <strong>interface</strong> that matches the existing props (you can name it \"Legacy<em>Something</em>\" if you'd like to make it clear for other developers that they're being deprecated).</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Hypothetical component with bad props</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">SomeComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> really<span class=\"token punctuation\">,</span> bad <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> props<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      I'm not the sharpest tool in the shed, and I use </span><span class=\"token punctuation\">{</span>really<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> </span><span class=\"token punctuation\">{</span>bad<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> props in\n      here\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nSomeComponent<span class=\"token punctuation\">.</span>propTypes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  really<span class=\"token operator\">:</span> PropTypes<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n  bad<span class=\"token operator\">:</span> PropTypes<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n  signature<span class=\"token operator\">:</span> PropTypes<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Becomes:</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">ILegacySomeComponentProps</span> <span class=\"token punctuation\">{</span>\n  really<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  bad<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  signature<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">SomeComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props<span class=\"token operator\">:</span> ILegacySomeComponentProps</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> really<span class=\"token punctuation\">,</span> bad <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> props<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      I'm not the sharpest tool in the shed, and I use </span><span class=\"token punctuation\">{</span>really<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> </span><span class=\"token punctuation\">{</span>bad<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> props in\n      here\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>NOTE: You can use types instead. Just stick to some convention that everyone agrees with.</em></p>\n<h3>3. Come up with a better signature</h3>\n<p>This requires the biggest effort. Now that you are deprecating something bad, you should try to <strong>come up with a new signature that resists time</strong> and makes everyone happy in the long run.</p>\n<p>There's no rule of thumb here, but you should have a better idea of how it should look after feeling the frustration coming from preexisting limitations.</p>\n<p>You should also leave room for further improvement (i.e. don't try to come up with a perfect design for all future cases. Trust me: it can't be as bad as what you already have).</p>\n<h3>4. Create a new signature and branch behaviors</h3>\n<p>Typescript has this awesome feature called <strong>control flow analysis</strong>, which lets the compiler <strong>narrow down types</strong> based on type checks (i.e. it will infere a variable's type based on unreachable code).</p>\n<p>If you combine this with <strong>type unions</strong> (which let you compose interfaces for the same parameter), you can branch completely different behaviors in a safe way.</p>\n<p>You should go ahead and <strong>create a new interface</strong> for the improved signature you came up with, and cha<strong>nge the component's signature to use a type union</strong> that handles both prop types.</p>\n<p>In order to achieve this, you have to create a helper function that will <strong>determine if the passed props are legacy</strong>. This is done by the <code class=\"language-text\">isLegacy</code> function, and its implementation depends on your particular case (here we just checked if the <code class=\"language-text\">bad</code> hypothetical prop is present or not).</p>\n<p>You can read more on this (and many other great TS features) <a href=\"https://www.typescriptlang.org/docs/handbook/2/narrowing.html\">here</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">ILegacySomeComponentProps</span> <span class=\"token punctuation\">{</span>\n  really<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  bad<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  signature<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// These will be the props that everyone should use from now on.</span>\n<span class=\"token comment\">// Note how this can be completely different from the legacy one.</span>\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">ISomeComponentProps</span> <span class=\"token punctuation\">{</span>\n  better<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  signature<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Props</span> <span class=\"token operator\">=</span> ILegacySomeComponentProps <span class=\"token operator\">|</span> IConfirmationProps<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">isLegacy</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props<span class=\"token operator\">:</span> Props</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> props <span class=\"token keyword\">is</span> ILegacySomeComponentProps <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>props <span class=\"token keyword\">as</span> ILegacySomeComponentProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>bad <span class=\"token operator\">!==</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">SomeComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props<span class=\"token operator\">:</span> Props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isLegacy</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        I'm not the sharpest tool in the shed, and I use </span><span class=\"token punctuation\">{</span>really<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> </span><span class=\"token punctuation\">{</span>bad<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> props in\n        here\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      Here goes the fancy new behavior! I can use </span><span class=\"token punctuation\">{</span>signature<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> here but not the\n      old ones\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>5. Enjoy responsibly</h3>\n<p>Keep in mind that, even though you'll be able to clear your path towards better features, you'll still have to maintain the legacy implementation and <strong>migrate everything</strong> as early as possible. Technical debt gets harder to fix overtime, so it should be prioritized thoughtfully.</p>\n<p>Also, there's nothing more pleasant than deleting deprecated code.</p>\n<h2>TL;DR</h2>\n<p><strong>You will have to bite the bullet and rewrite bad code eventually</strong>, but you can make sure it happens <strong>smoothly over time</strong> by using type checking tricks.</p>","frontmatter":{"title":"Migrating bad React components with Typescript","description":"A powerful trick to fix unusable props by using type unions","date":"08/27/2021","picture":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAAD/8QAFgEBAQEAAAAAAAAAAAAAAAAABAID/9oADAMBAAIQAxAAAAFYgJwrOxmG/8QAGxAAAgMAAwAAAAAAAAAAAAAAAQIAAxIEEzH/2gAIAQEAAQUCfkZnYbDqBybEYvD7/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAx/9oACAEDAQE/AQHYL//EABcRAAMBAAAAAAAAAAAAAAAAAAABEQL/2gAIAQIBAT8B3RSH/8QAHBAAAQMFAAAAAAAAAAAAAAAAARARIQACMVFx/9oACAEBAAY/AsTRe88Uu0DSf//EABsQAQACAwEBAAAAAAAAAAAAAAEAMREhQVFh/9oACAEBAAE/IRBZc8lPAZBqKzcQfDMGXA1Fk//aAAwDAQACAAMAAAAQGD//xAAYEQEAAwEAAAAAAAAAAAAAAAABABGRIf/aAAgBAwEBPxCyxkVDk//EABcRAAMBAAAAAAAAAAAAAAAAAAABETH/2gAIAQIBAT8QdbMGkf/EABwQAQADAAIDAAAAAAAAAAAAAAEAESExkUHB8P/aAAgBAQABPxBGEDbWdI8SsSmS/wB8wBFCkLen3EesFAAe/US6+Z//2Q=="},"images":{"fallback":{"src":"/static/32fbd905fc21d271eb72905ce5ff9880/987ab/la-rel-easter-kucglbxjh_o-unsplash.jpg","srcSet":"/static/32fbd905fc21d271eb72905ce5ff9880/7284f/la-rel-easter-kucglbxjh_o-unsplash.jpg 750w,\n/static/32fbd905fc21d271eb72905ce5ff9880/29ba9/la-rel-easter-kucglbxjh_o-unsplash.jpg 1080w,\n/static/32fbd905fc21d271eb72905ce5ff9880/987ab/la-rel-easter-kucglbxjh_o-unsplash.jpg 2400w","sizes":"(min-width: 2400px) 2400px, 100vw"},"sources":[{"srcSet":"/static/32fbd905fc21d271eb72905ce5ff9880/57584/la-rel-easter-kucglbxjh_o-unsplash.webp 750w,\n/static/32fbd905fc21d271eb72905ce5ff9880/984df/la-rel-easter-kucglbxjh_o-unsplash.webp 1080w,\n/static/32fbd905fc21d271eb72905ce5ff9880/15fc2/la-rel-easter-kucglbxjh_o-unsplash.webp 2400w","type":"image/webp","sizes":"(min-width: 2400px) 2400px, 100vw"}]},"width":2400,"height":1600}}},"credit":"Photo by <a href=\"https://unsplash.com/@lastnameeaster?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">La-Rel Easter</a> on <a href=\"https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a>   "}}},"pageContext":{"id":"ddb60b4c-1f43-59ba-b35a-9f94ca7836f9"}},"staticQueryHashes":[]}