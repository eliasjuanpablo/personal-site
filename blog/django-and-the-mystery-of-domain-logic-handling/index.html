<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e53586a225ffdde20c86.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 3.11.0"/><title data-react-helmet="true">Django and the mystery of domain logic handling | Juan Pablo Elias - Fullstack Web Developer</title><meta data-react-helmet="true" name="description" content="Juan&#x27;s personal site &amp; opinionated blog"/><meta data-react-helmet="true" property="og:title" content="Django and the mystery of domain logic handling"/><meta data-react-helmet="true" property="og:description" content="Juan&#x27;s personal site &amp; opinionated blog"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Juan Pablo Elias"/><meta data-react-helmet="true" name="twitter:title" content="Django and the mystery of domain logic handling"/><meta data-react-helmet="true" name="twitter:description" content="Juan&#x27;s personal site &amp; opinionated blog"/><style data-styled="" data-styled-version="5.3.0">.buPRoe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:1rem;font-family:monospace;background:cornflowerblue;padding:1em;text-align:center;}/*!sc*/
data-styled.g1[id="Footer__Wrapper-sc-1o3xk0p-0"]{content:"buPRoe,"}/*!sc*/
.hMhOCN{color:white;}/*!sc*/
data-styled.g2[id="Footer__Copyright-sc-1o3xk0p-1"]{content:"hMhOCN,"}/*!sc*/
.dpTqmQ{color:cornflowerblue;background:white;font-size:1.2rem;font-family:monospace;border-bottom:1px solid cornflowerblue;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}/*!sc*/
data-styled.g3[id="Navbar__Nav-sc-1l5ocr3-0"]{content:"dpTqmQ,"}/*!sc*/
.grLxcP{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;}/*!sc*/
@media (min-width:1024px){.grLxcP{width:60%;}}/*!sc*/
data-styled.g4[id="Navbar__Wrapper-sc-1l5ocr3-1"]{content:"grLxcP,"}/*!sc*/
.jlQdek{font-weight:800;-webkit-flex:0 0 50%;-ms-flex:0 0 50%;flex:0 0 50%;padding:0.5em;text-align:center;}/*!sc*/
data-styled.g5[id="Navbar__Brand-sc-1l5ocr3-2"]{content:"jlQdek,"}/*!sc*/
.ixclZx{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding:0 1em;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-top:0;-webkit-flex-direction:row-reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;}/*!sc*/
.ixclZx a{margin-top:0;}/*!sc*/
.ixclZx a + a{margin-right:1em;}/*!sc*/
data-styled.g6[id="Navbar__Links-sc-1l5ocr3-3"]{content:"ixclZx,"}/*!sc*/
:root{font-size:4vw;}/*!sc*/
@media (min-width:768px){:root{font-size:2vw;}}/*!sc*/
@media (min-width:1024px){:root{font-size:16px;}}/*!sc*/
*,*:before,*:after{box-sizing:border-box;}/*!sc*/
body{margin:0;padding:0;font-family:sans-serif;background:#eee;}/*!sc*/
h1{margin:0;}/*!sc*/
a{-webkit-text-decoration:none;text-decoration:none;color:cornflowerblue;}/*!sc*/
figure{margin:0;}/*!sc*/
blockquote{margin:0;}/*!sc*/
* + *{margin-top:1em;}/*!sc*/
#query-on-demand-indicator-element{margin-top:0;}/*!sc*/
data-styled.g8[id="sc-global-eoYfnO1"]{content:"sc-global-eoYfnO1,"}/*!sc*/
.kMQiqc{padding-top:1em;min-height:100vh;}/*!sc*/
@media (min-width:768px){.kMQiqc{width:60%;margin:auto;}}/*!sc*/
data-styled.g10[id="Layout__Content-sc-110mw15-1"]{content:"kMQiqc,"}/*!sc*/
.jBVTqX{margin-left:-1em;margin-right:-1em;padding:1em;background:rgba(0,0,0,0.05);border-radius:10px;}/*!sc*/
data-styled.g30[id="AdjacentPosts__Wrapper-sc-ykb4yh-0"]{content:"jBVTqX,"}/*!sc*/
.cOfaGt{margin:0;}/*!sc*/
data-styled.g31[id="AdjacentPosts__Title-sc-ykb4yh-1"]{content:"cOfaGt,"}/*!sc*/
.eYgmmR a{display:block;}/*!sc*/
@media (min-width:768px){.eYgmmR{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}.eYgmmR a{margin-top:0;text-align:center;}}/*!sc*/
data-styled.g32[id="AdjacentPosts__Posts-sc-ykb4yh-2"]{content:"eYgmmR,"}/*!sc*/
.jYENwO{padding:0 1em;overflow-x:hidden;font-size:1.2rem;}/*!sc*/
data-styled.g33[id="blog-post__Wrapper-sc-18ub0w7-0"]{content:"jYENwO,"}/*!sc*/
.jMfmCY{font-size:2em;}/*!sc*/
data-styled.g34[id="blog-post__Title-sc-18ub0w7-1"]{content:"jMfmCY,"}/*!sc*/
.iSCHAV{margin-top:0.5em;opacity:0.5;}/*!sc*/
data-styled.g35[id="blog-post__Description-sc-18ub0w7-2"]{content:"iSCHAV,"}/*!sc*/
.ifnQYK{max-width:100%;}/*!sc*/
@media (min-width:1024px){.ifnQYK{margin-left:-2em;margin-right:-2em;max-width:120%;}}/*!sc*/
data-styled.g36[id="blog-post__Picture-sc-18ub0w7-3"]{content:"ifnQYK,"}/*!sc*/
.fAifdE{margin-top:0.5em;font-size:0.8em;color:gray;text-align:center;}/*!sc*/
.fAifdE > a{color:inherit;-webkit-text-decoration:underline;text-decoration:underline;}/*!sc*/
data-styled.g37[id="blog-post__Credit-sc-18ub0w7-4"]{content:"fAifdE,"}/*!sc*/
.bNAzej{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-family:monospace;font-size:0.9em;}/*!sc*/
.bNAzej > *{margin-top:0;}/*!sc*/
.bNAzej img{width:3em;border-radius:100%;margin-right:0.5em;border:2px solid cornflowerblue;}/*!sc*/
data-styled.g38[id="blog-post__Author-sc-18ub0w7-5"]{content:"bNAzej,"}/*!sc*/
.dRCAyP{font-size:0.8em;}/*!sc*/
data-styled.g39[id="blog-post__PostDate-sc-18ub0w7-6"]{content:"dRCAyP,"}/*!sc*/
.gzwFgS{line-height:1.5;max-width:90vw;margin-bottom:4em;}/*!sc*/
.gzwFgS > blockquote{background:rgba(0,0,0,0.05);border-left:2px solid gray;padding:1em;font-style:italic;}/*!sc*/
.gzwFgS > figure > figcaption{font-size:0.8em;color:gray;text-align:center;margin-top:0.5em;}/*!sc*/
.gzwFgS .gatsby-highlight{overflow:auto;}/*!sc*/
.gzwFgS .gatsby-highlight-code-line{margin-top:0;background-color:hsl(76deg 17% 26%);display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:0.75em;border-left:0.25em solid #f99;}/*!sc*/
.gzwFgS .gatsby-highlight pre[class*="language-"]{float:left;min-width:100%;}/*!sc*/
.gzwFgS .language-text{white-space:nowrap;background:#adadad6b;color:inherit;border-radius:0;}/*!sc*/
data-styled.g40[id="blog-post__Body-sc-18ub0w7-7"]{content:"gzwFgS,"}/*!sc*/
</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><link as="script" rel="preload" href="/webpack-runtime-b55dc8c1db01917d190e.js"/><link as="script" rel="preload" href="/framework-5ad3590fa530dad38c4f.js"/><link as="script" rel="preload" href="/532a2f07-4a23b5dc76ca3ecdd8d9.js"/><link as="script" rel="preload" href="/app-bf5a31202d815fbfdde9.js"/><link as="script" rel="preload" href="/commons-d26dab2fec9a8570d6c9.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-71c07cf0ac1700f58e2f.js"/><link as="fetch" rel="preload" href="/page-data/blog/django-and-the-mystery-of-domain-logic-handling/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout__Wrapper-sc-110mw15-0 imYlhD"><nav class="Navbar__Nav-sc-1l5ocr3-0 dpTqmQ"><div class="Navbar__Wrapper-sc-1l5ocr3-1 grLxcP"><div class="Navbar__Brand-sc-1l5ocr3-2 jlQdek"><a href="/">jpelias</a></div><div class="Navbar__Links-sc-1l5ocr3-3 ixclZx"><a class="Navbar__NavLink-sc-1l5ocr3-4 hAcmiF" href="/blog">blog</a></div></div></nav><div class="Layout__Content-sc-110mw15-1 kMQiqc"><article class="blog-post__Wrapper-sc-18ub0w7-0 jYENwO"><h1 class="blog-post__Title-sc-18ub0w7-1 jMfmCY">Django and the mystery of domain logic handling</h1><div class="blog-post__Description-sc-18ub0w7-2 iSCHAV">Writing Django projects that resist time</div><div class="blog-post__Author-sc-18ub0w7-5 bNAzej"><img src="/static/avatar-91b209b0ddfc00b547b4d90874016311.jpeg" alt="avatar"/><div>Juan Pablo Elias <br/><span class="blog-post__PostDate-sc-18ub0w7-6 dRCAyP">09/09/2021</span></div></div><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained blog-post__Picture-sc-18ub0w7-3 ifnQYK"><div style="max-width:2400px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1800&#x27; width=&#x27;2400&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAgP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQP/2gAMAwEAAhADEAAAAWa4zQyOg0//xAAZEAADAQEBAAAAAAAAAAAAAAABAgMRIgD/2gAIAQEAAQUCCY1bgGcOG1WTp/f/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEv/aAAgBAwEBPwGz/8QAFREBAQAAAAAAAAAAAAAAAAAAEBL/2gAIAQIBAT8Bk//EAB8QAAIBAgcAAAAAAAAAAAAAAAACARESECEiMWFykf/aAAgBAQAGPwK96LwWLuZs8T2NfpRcP//EABwQAQADAAIDAAAAAAAAAAAAAAEAESEQcUGh0f/aAAgBAQABPyEutrX7jxG3n5KBeNQg7Ij2lzTBxeP/2gAMAwEAAgADAAAAEAQv/8QAFxEBAQEBAAAAAAAAAAAAAAAAAREQMf/aAAgBAwEBPxCFh3P/xAAXEQEBAQEAAAAAAAAAAAAAAAABIRAR/9oACAECAQE/EOypM//EAB4QAQACAQQDAAAAAAAAAAAAAAEAESExQVGhYXHB/9oACAEBAAE/EBLHqCQ8q+SkIqTe/Zjpu5F3d5h6xco0eomR5Go3i5n/2Q==" alt=""/><picture><source type="image/webp" data-srcset="/static/4c0cde2dabd0cddcf7a51b72e33f1167/66907/faisal-g0rtzc1ibtu-unsplash.webp 750w,/static/4c0cde2dabd0cddcf7a51b72e33f1167/27610/faisal-g0rtzc1ibtu-unsplash.webp 1080w,/static/4c0cde2dabd0cddcf7a51b72e33f1167/39d9b/faisal-g0rtzc1ibtu-unsplash.webp 2400w" sizes="(min-width: 2400px) 2400px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2400px) 2400px, 100vw" decoding="async" loading="lazy" data-src="/static/4c0cde2dabd0cddcf7a51b72e33f1167/2d418/faisal-g0rtzc1ibtu-unsplash.jpg" data-srcset="/static/4c0cde2dabd0cddcf7a51b72e33f1167/6c918/faisal-g0rtzc1ibtu-unsplash.jpg 750w,/static/4c0cde2dabd0cddcf7a51b72e33f1167/49438/faisal-g0rtzc1ibtu-unsplash.jpg 1080w,/static/4c0cde2dabd0cddcf7a51b72e33f1167/2d418/faisal-g0rtzc1ibtu-unsplash.jpg 2400w" alt=""/></picture><noscript><picture><source type="image/webp" srcSet="/static/4c0cde2dabd0cddcf7a51b72e33f1167/66907/faisal-g0rtzc1ibtu-unsplash.webp 750w,/static/4c0cde2dabd0cddcf7a51b72e33f1167/27610/faisal-g0rtzc1ibtu-unsplash.webp 1080w,/static/4c0cde2dabd0cddcf7a51b72e33f1167/39d9b/faisal-g0rtzc1ibtu-unsplash.webp 2400w" sizes="(min-width: 2400px) 2400px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2400px) 2400px, 100vw" decoding="async" loading="lazy" src="/static/4c0cde2dabd0cddcf7a51b72e33f1167/2d418/faisal-g0rtzc1ibtu-unsplash.jpg" srcSet="/static/4c0cde2dabd0cddcf7a51b72e33f1167/6c918/faisal-g0rtzc1ibtu-unsplash.jpg 750w,/static/4c0cde2dabd0cddcf7a51b72e33f1167/49438/faisal-g0rtzc1ibtu-unsplash.jpg 1080w,/static/4c0cde2dabd0cddcf7a51b72e33f1167/2d418/faisal-g0rtzc1ibtu-unsplash.jpg 2400w" alt=""/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><div class="blog-post__Credit-sc-18ub0w7-4 fAifdE">Photo by <a href="https://unsplash.com/@faisaldada?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Faisal</a> on <a href="https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>   </div><div class="blog-post__Body-sc-18ub0w7-7 gzwFgS"><blockquote>
<p>“The heart of software is its ability to solve domain-related problems for its user.”
― Eric Evans, Domain-Driven Design: Tackling Complexity in the Heart of Software</p>
</blockquote>
<p>NOTE: this is not an in-depth <a href="https://en.wikipedia.org/wiki/Domain-driven_design">DDD</a> nor <a href="https://en.wikipedia.org/wiki/Hexagonal_architecture_(software)">Hexagonal Architecture</a> post, but it's meant to borrow their core concepts and try to fit them into Django's world. Feel free to do your research.</p>
<h2>The prominent "Domain"</h2>
<p>By definition, every application models some aspect of a problem (e.g. real life business processes) in a way that reflects how its moving parts interact between eachother. We call this "problem's universe" its <strong>Domain</strong>, and you can think about it as a <strong>software representation of a business model</strong>. This means that, as a software developer, the domain model is your bread-and-butter: <strong>every line of code you write exists because of it.</strong></p>
<p>Sounds important, right? Well, it is, and <strong>a lot has been written around it,</strong> so in this post I'll try to fit the most significative concepts into Django's world, and cover certain caveats that you may encounter.</p>
<h2>Layering</h2>
<p>First of all, having said how important the domain model is, it becomes clear that it should be <strong>thoughtfully handled</strong>, in a way that it becomes <strong>clearly distinguishable</strong> from all the paraphernalia that makes your code work.</p>
<p>The proper way to achieve this is <strong>layering.</strong></p>
<p>Layering is everywhere in our industry (e.g. Operating Systems, Networks, Security). It provides a way to <strong>decouple responsibilities by isolating concerns</strong>, so that they only <strong>expose some sort of signature</strong> that allows interaction <strong>without leaking subjacent implementations</strong>.</p>
<p>Well, your business domain is no different. That's why the concept of a <strong>domain layer</strong> exists: the project's core should be <strong>completely independent from the underlying infrastructure</strong> that powers it (i.e. web framework, persistence technology, cloud provider).</p>
<h2>Django's way</h2>
<blockquote>
<p>When deciding where to put a piece of code, we like to follow the “<em>Fat Models</em>, Helper Modules, thin Views, <em>Stupid Templates</em>” approach ― Daniel Roy Greenfeld &#x26; Audrey Roy Greenfeld, Two Scoops Of Django</p>
</blockquote>
<p>Incidentally, Django has its own opinions around separations of concerns. It uses an <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC</a>-ish high level idea but also allows you to put logic in several places, so I'll try to list some <em>do's and don'ts</em> that I've found useful for the projects I've worked on.</p>
<h2>Where NOT to put domain logic</h2>
<p>Let's start by listing where you shouldn't put your application's core.</p>
<h3><strong>Templates</strong></h3>
<p>These are meant to provide a <strong>user-facing visual representation of your app</strong>. In a typical off-the-shelf scenario, you'll be using server side rendered HTML files, but you could easily have <strong>several <em>clients</em></strong> (as in devices, not people) that would need to consume the same data (e.g. if you decouple your frontend and use django as a <a href="https://www.django-rest-framework.org/">RESTful API</a>, you could have a mobile app + a web page that consume the same endpoints). This makes it obvious <strong>NOT to put important decision-making capabilities</strong> in here, as it would imply <strong>replicating this logic on every client</strong>. Luckily, <strong>Django's template language is constrained</strong> in a way that it doesn't allow you to get too creative (e.g. you can't perform queries inside of them).</p>
<p>Always try to keep your templates as stupid as possible.</p>
<h3><strong>Forms</strong></h3>
<p>If you've done any simple CRUD page in Django, there's a huge chance you've used its built-in forms. They allow you to <strong>validate incoming data in a declarative way</strong> and <strong>render an HTML form</strong> with simple template interpolations. You may have noticed that they are <strong>tightly coupled to templates</strong> (i.e. you wouldn't use them in any other context), so what's been explained above also applies in here. You don't want to put complex decision making directly in your form classes, as <strong>they may not be used as a data entrypoint in other scenarios</strong>, which would force you to replicate that logic elsewhere. However, you can still use them as pass-throughs and leverage your models' logic (e.g. using <code class="language-text">ModelForm</code>).</p>
<p>I'll discuss models' domain logic handling below, but for the sake of forms, try not to make them excessively complex.</p>
<h3><strong>Views</strong></h3>
<p>In my opinion, the most controversial part of Django. First of all, from a <a href="https://docs.djangoproject.com/en/3.2/faq/general/#django-appears-to-be-a-mvc-framework-but-you-call-the-controller-the-view-and-the-view-the-template-how-come-you-don-t-use-the-standard-names">naming perspective</a>, and then from mysterious parts of the official docs, such as this quote:</p>
<blockquote>
<p>Where does the “controller” fit in, then? In Django’s case, it’s probably the framework itself: the machinery that sends a request to the appropriate view, according to the Django URL configuration. ― Django FAQs</p>
</blockquote>
<p>If you ask me, <em>controllers</em> handle the incoming request and determines what should be done. Which is basically what <em>views</em> do, so I find this theoretical differentiation to be unnecesarily confusing.</p>
<p>This means that <strong>putting domain logic inside views will have the same "entrypoint-coupled" problem</strong> that was described earlier: what if you need the same logic somewhere else (e.g. another view)? Well, that's why you should move your domain layer as far away from your entrypoints as possible.</p>
<p><strong>You should keep your views <em>thin</em></strong>.</p>
<p>You may also have seen some code examples in Django's documentation like this one:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SomeView</span><span class="token punctuation">(</span>ListView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> SomeModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>some__crazy__lookup<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></code></pre></div>
<p>and even though this could be enough for small sized projects, this is not the best of ideas.</p>
<p>For example, imagine you are developing an e-commerce platform and you want to list every product that's considered to be interesting for the user that's visiting the landing page. For your particular business, an "important product" would be found by <strong>filtering by some specific criteria</strong> (hypothetically using any kind of historical data). Now, let's say you go ahead and override the <code class="language-text">get_queryset</code> method of that URL's view and put all the fancy filtering in there.</p>
<p>That works, right? But what if two weeks later you want to add periodic tasks that send emails to your users with interesting offers that could grab their attention?. In this scenario, you would have to <strong>replicate the same filtering,</strong> as the concept of an "important product" exists across different use cases. If you rewrite the same rules everywhere, you'll also have to maintain each one of them separately when requirements change over time.</p>
<p>How painful. It's clear at this point that <strong>views are a really bad place for domain logic</strong> to live.</p>
<h3>Serializers (Django Rest Framework)</h3>
<p>Even though this isn't a DRF focused post, it's pretty interesting how they also became a tempting place to put domain logic in, so I didn't want to leave them out.</p>
<p>In a word, serializers are translators (a.k.a. Data Transfer Objects) that <strong>convert JSON into Python and viceversa</strong>. They are important when developing a RESTful API, as they format data in both directions and therefore allow end-to-end communication.</p>
<p>However, <strong>serializer classes allow to override certain CRUD methods</strong> (e.g. <code class="language-text">create</code>, <code class="language-text">update</code>, <code class="language-text">save</code>) so you can add arbitrary logic there (which will only be executed after the incoming data has been properly validated, so it sounds great), but this is, again, a <strong>really bad idea</strong>.</p>
<p>See this example from the DRF docs:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ContactForm</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    email <span class="token operator">=</span> serializers<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    message <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">save</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        email <span class="token operator">=</span> self<span class="token punctuation">.</span>validated_data<span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span>
        message <span class="token operator">=</span> self<span class="token punctuation">.</span>validated_data<span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span>
        send_email<span class="token punctuation">(</span><span class="token keyword">from</span><span class="token operator">=</span>email<span class="token punctuation">,</span> message<span class="token operator">=</span>message<span class="token punctuation">)</span></code></pre></div>
<p>According to this example's description, <code class="language-text">save</code> has been overriden here because it's more "meaningful" than <code class="language-text">create</code> or <code class="language-text">update</code>. I personally don't think that its subtle naming matters too much, and I'd never expect emails to be sent inside a payload validator. Serializers are meant to fit data into certain schemas for different entrypoints (e.g. you could reuse and compose them for different endpoints' expected payloads) but this doesn't mean you'll always execute the same logic for every scenario.</p>
<p>I hope that besides my opinion, you can see that it feels incorrect to put your domain logic in here.</p>
<h2>Where to put domain logic</h2>
<p>Now that we've seen common caveats, let's see what may be better.</p>
<h3>Model methods</h3>
<p>If you are familiar with OOP principles, you already know that classes provide a way to <strong>encapsulate data along with the behavior that operates with it</strong>. You would tipically design entities that represent aspects of "real life" and declare a public set of methods that allow other entities to interact with them without being aware of their private attributes.</p>
<p>Well, <strong>models can easily work this way</strong> effortlessly: after all, they are classes with data (i.e. their database fields as attributes) and behavior (the methods you can add to them).</p>
<p>Also, you should note that <strong>they have an intrinsic business meaning</strong> (i.e. they have a role in the business domain), so they are naturally a good place to handle complex logic.</p>
<p>There are several ways to handle domain logic inside models. The simplest one involves <strong>adding methods</strong>.</p>
<p>Getting back to the hypothetical e-commerce platform, let's say this is its oversimplified data model:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># ----- models.py -----</span>

<span class="token keyword">class</span> <span class="token class-name">Product</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    category <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> choices<span class="token operator">=</span>PRODUCT_CATEGORIES<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># fields not listed as they won't be used</span>


<span class="token keyword">class</span> <span class="token class-name">Purchase</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    product <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Product<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>User<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre></div>
<p>What if you want to get product suggestions when they visit a certain URL? Let's say that want to offer products that have the same category as those that have been purchased by the user within the last 7 days.</p>
<p>In order to keep our view unaware of the domain, you could do something like this:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># ----- models.py -----</span>

<span class="token keyword">class</span> <span class="token class-name">Product</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    category <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="gatsby-highlight-code-line">    <span class="token decorator annotation punctuation">@classmethod</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">get_suggested_for_user</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        <span class="token triple-quoted-string string">"""Returns product suggestions based on recently purchased categories."""</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">        recently_purchased_categories <span class="token operator">=</span> <span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">            Purchase</span><span class="gatsby-highlight-code-line">            <span class="token punctuation">.</span>get_user_recent_purchases<span class="token punctuation">(</span>user<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">            <span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'product__category'</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">            <span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">        <span class="token keyword">return</span> cls<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>category__in<span class="token operator">=</span>recently_purchased_categories<span class="token punctuation">)</span></span>

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">Purchase</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    product <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Product<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">'purchases'</span><span class="token punctuation">)</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>User<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="gatsby-highlight-code-line">    <span class="token decorator annotation punctuation">@classmethod</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">get_user_recent_purchases</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        <span class="token triple-quoted-string string">"""Returns a user's recent purchases."""</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">        from_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">            cls<span class="token punctuation">.</span>objects</span><span class="gatsby-highlight-code-line">            <span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">                date__gte<span class="token operator">=</span>from_date<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                user<span class="token operator">=</span>user<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">            <span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">)</span></span>

<span class="token comment"># ----- views.py -----</span>

<span class="token comment"># Let's imagine this view is being pointed to from the /catalog url inside a urls.py file</span>
<span class="token keyword">class</span> <span class="token class-name">CatalogView</span><span class="token punctuation">(</span>ListView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Let's say you can get the current User from the request with a util function</span>
        user <span class="token operator">=</span> get_user<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">        <span class="token comment"># Delegates handling to the model, hence this view doesn't need to know what's the suggestions criteria.</span></span><span class="gatsby-highlight-code-line">        <span class="token comment"># If the filtering changes over time, this piece of code stays untouched.</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">return</span> Product<span class="token punctuation">.</span>get_suggested_for_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span></span></code></pre></div>
<p>Some quick notes here:</p>
<ul>
<li>This allows you to reuse the product suggestions rules for other use cases.</li>
<li>This implementation uses classmethods, just because it's meant to provide a way to query by certain criteria using the models' objects manager. You will end up adding instance methods for other purposes too.</li>
<li>There's no correct answer around where to put behavior (that's basically a design decision you have to make). I'll cover an alternative approach that can prevent this later in this post. For now, this contrived example is meant to show how different entities can interact between eachother by using their methods.</li>
</ul>
<h3>Model's custom manager</h3>
<p>Django also provides its own way to handle domain logic, which involves <strong>overriding the default</strong> <code class="language-text">objects</code> <strong>manager</strong>, or adding a new one. You can read more in the <a href="https://docs.djangoproject.com/en/3.2/topics/db/managers/">docs</a>.</p>
<p>This approach is not so different from the model methods described above. First, it changes the way these methods will be called (e.g. instead of <code class="language-text">Product.get_suggested_for_user(user)</code> you may write something like <code class="language-text">Product.objects.suggested_for_user(user)</code>).</p>
<p>Also, you can override the <code class="language-text">get_queryset</code> method with common annotations or filtering so that you avoid repetition in certain scenarios.</p>
<p>We could rewrite our example using this approach:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># ----- models.py -----</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">class</span> <span class="token class-name">ProductManager</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Manager<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">suggested_for_user</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        <span class="token triple-quoted-string string">"""Returns product suggestions based on recently purchased categories."""</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">        recently_purchased_categories <span class="token operator">=</span> <span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">            Purchase</span><span class="gatsby-highlight-code-line">            <span class="token punctuation">.</span>objects</span><span class="gatsby-highlight-code-line">            <span class="token punctuation">.</span>get_user_recent_purchases<span class="token punctuation">(</span>user<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">            <span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'product__category'</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">            <span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>category__in<span class="token operator">=</span>recently_purchased_categories<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"></span>
<span class="token keyword">class</span> <span class="token class-name">Product</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    category <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="gatsby-highlight-code-line">    objects <span class="token operator">=</span> ProductManager<span class="token punctuation">(</span><span class="token punctuation">)</span></span>

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


<span class="gatsby-highlight-code-line"><span class="token keyword">class</span> <span class="token class-name">PurchaseManager</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Manager<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">def</span> <span class="token function">get_user_recent_purchases</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">        <span class="token triple-quoted-string string">"""Returns a user's recent purchases."""</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">        from_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">            self</span><span class="gatsby-highlight-code-line">            <span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">                date__gte<span class="token operator">=</span>from_date<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                user<span class="token operator">=</span>user<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">            <span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">)</span></span>

<span class="token keyword">class</span> <span class="token class-name">Purchase</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    product <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Product<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">'purchases'</span><span class="token punctuation">)</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>User<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="gatsby-highlight-code-line">    objects <span class="token operator">=</span> PurchaseManager<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="token comment"># ----- views.py -----</span>

<span class="token comment"># Let's imagine this view is being pointed to from the /catalog url inside a urls.py file</span>
<span class="token keyword">class</span> <span class="token class-name">CatalogView</span><span class="token punctuation">(</span>ListView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Let's say you can get the current User from the request with a util function</span>
        user <span class="token operator">=</span> get_user<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">        <span class="token keyword">return</span> Product<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>suggested_for_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span></span></code></pre></div>
<p>You can combine custom Querysets and Managers. I've avoided being too clever in here for simplicity sake, but you can find more examples <a href="https://docs.djangoproject.com/en/3.2/topics/db/managers/#from-queryset">here</a>.</p>
<h3>Domain Services &#x26; Selectors</h3>
<blockquote>
<p><em>NOTE: "Domain services" are a concept borrowed from <a href="https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215">Eric Evans' DDD Book</a>, although simplified for our purposes. Also, "selectors" work similarly to DDD's repositories, but its name has been taken from this <a href="https://github.com/HackSoftware/Django-Styleguide">popular Django styleguide</a>. I'm not interested in being dogmatic / theoretically accurate here, so I'll just cover their core concepts so you can benefit from them.</em></p>
</blockquote>
<p>So far we've seen how to use <strong>fat models</strong>, which in my opinion should be the <strong>default approach</strong> no matter the scale of your project. It requires almost the same effort when compared to putting everything in your views, and it can <strong>save you a lot of refactoring headaches</strong> down the road.</p>
<p>However, if your application grows significantly (or your domain is complex enough) you may find yourself <strong>maintaining huge models</strong> that do a lot of different things, or <strong>having trouble deciding where to put new behavior</strong> to avoid this in the first place.</p>
<p>In this scenario, <strong>Services</strong> and <strong>Selectors</strong> come in handy, as they do all the domain heavylifting themselves.</p>
<p>This allows you to <strong>move the domain logic from your models to a more centralized approach, where a set of functions are responsible for orchestrating how entities behave</strong>.</p>
<p>Our previous example could look like this:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># ----- models.py -----</span>

<span class="token keyword">class</span> <span class="token class-name">Product</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    category <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> choices<span class="token operator">=</span>PRODUCT_CATEGORIES<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>


<span class="token keyword">class</span> <span class="token class-name">Purchase</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    product <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Product<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">'purchases'</span><span class="token punctuation">)</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>User<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># ----- selectors.py -----</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">def</span> <span class="token function">get_user_recent_purchases</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">      <span class="token triple-quoted-string string">"""Returns a user's recent purchases."""</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">    from_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">        Purchase</span><span class="gatsby-highlight-code-line">        <span class="token punctuation">.</span>objects</span><span class="gatsby-highlight-code-line">        <span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">            date__gte<span class="token operator">=</span>from_date<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">            user<span class="token operator">=</span>user<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line"><span class="token keyword">def</span> <span class="token function">get_suggested_products_for_user</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">:</span></span><span class="gatsby-highlight-code-line">    <span class="token triple-quoted-string string">"""Returns product suggestions based on recently purchased categories."""</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">    recently_purchased_categories <span class="token operator">=</span> <span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">        get_user_recent_purchases<span class="token punctuation">(</span>user<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'product__category'</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> Product<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>category__in<span class="token operator">=</span>recently_purchased_categories<span class="token punctuation">)</span></span>


<span class="token comment"># ----- views.py -----</span>

<span class="token comment"># Let's imagine this view is being pointed to from the /catalog url inside a urls.py file</span>
<span class="token keyword">class</span> <span class="token class-name">CatalogView</span><span class="token punctuation">(</span>ListView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Let's say you can get the current User from the request with a util function</span>
        user <span class="token operator">=</span> get_user<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">        <span class="token keyword">return</span> get_suggested_products_for_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span></span></code></pre></div>
<p>And you could also have a <code class="language-text">services.py</code> file like this one:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># ----- services.py -----</span>
<span class="token comment"># This is merely demonstrative.</span>

<span class="token keyword">def</span> <span class="token function">purchase_product</span><span class="token punctuation">(</span>product<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ... Validation based on business rules could happen here ...</span>

    purchase <span class="token operator">=</span> Purchase<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>product<span class="token operator">=</span>product<span class="token punctuation">,</span> user<span class="token operator">=</span>user<span class="token punctuation">)</span>

    <span class="token comment"># It could also enqueue asynchronous tasks (which could also call other services)</span>
    send_confirmation_email<span class="token punctuation">.</span>delay<span class="token punctuation">(</span>purchase<span class="token punctuation">)</span>

<span class="token comment"># ...</span></code></pre></div>
<p>Now, you may have noticed that this <strong>defeats the purpose of basic OOP principles</strong>. Your models become anemic (i.e. they are just <em>data bags</em> with no behavior attached to them), so this turns out to be this approach's biggest downside.</p>
<p><strong>The "services" concept is also deeper than what I've shown in this post</strong>. The proper DDD way would involve <strong>handling plain objects that are not aware of any infrastructure dependencies</strong>. You can achieve this by increasing the amount of layers (i.e. you could work with plain Python classes that be translated into Django database models for persistence purposes). However, when I find myself trying to achieve this kind of book-ish approach in Django, I end up feeling that I'm derailing too much.</p>
<p>In my opinion, it's considerably better to be fairly idiomatic and follow your tools' philosophy.</p>
<h3>Conclusions</h3>
<p>To be honest, <strong>every approach has its pros and cons</strong> (even if you put everything inside your views, you still have the advantage of simplicity!). I'd personally avoid trying to come up with the perfect cookiecutter where you fit all your projects in.</p>
<p>Also, most of these approaches aren't mutually exclusive, and the <strong>amount of engineering fanciness should vary between different domains,</strong> so keep it as simple as you can!</p>
<h3>TL;DR</h3>
<p>Keep your business logic away from your application's entrypoints. This will increase reusability and allow you to control entities' interactions in a more isolated way. The amount of overengineering depends on your scale.</p></div><div class="AdjacentPosts__Wrapper-sc-ykb4yh-0 jBVTqX"><h2 class="AdjacentPosts__Title-sc-ykb4yh-1 cOfaGt">More posts</h2><div class="AdjacentPosts__Posts-sc-ykb4yh-2 eYgmmR"><a href="/blog/migrating-react-components-signatures-with-typescript/">← <!-- -->Migrating bad React components with Typescript</a><div></div></div></div></article></div><footer class="Footer__Wrapper-sc-1o3xk0p-0 buPRoe"><small class="Footer__Copyright-sc-1o3xk0p-1 hMhOCN">© <!-- -->2021<!-- --> - Juan Pablo Elias</small></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EECN02Y1LN"></script><script>
      
      
      if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-EECN02Y1LN', {"send_page_view":false});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/django-and-the-mystery-of-domain-logic-handling/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4afa5113a14c63c56742.js"],"app":["/app-bf5a31202d815fbfdde9.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9f769462c943b4d05189.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-6f5f5d9235dbb3eaa35b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-f57f9d09325981d5cf2a.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-71c07cf0ac1700f58e2f.js"]};/*]]>*/</script><script src="/polyfill-4afa5113a14c63c56742.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-71c07cf0ac1700f58e2f.js" async=""></script><script src="/commons-d26dab2fec9a8570d6c9.js" async=""></script><script src="/app-bf5a31202d815fbfdde9.js" async=""></script><script src="/532a2f07-4a23b5dc76ca3ecdd8d9.js" async=""></script><script src="/framework-5ad3590fa530dad38c4f.js" async=""></script><script src="/webpack-runtime-b55dc8c1db01917d190e.js" async=""></script></body></html>